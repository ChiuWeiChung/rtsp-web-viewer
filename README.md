# RTSP 轉 MJPEG 轉換器

在工作上有個需求，需要把 IP Camera 的影像透過網頁播放，但後來才發現瀏覽器其實並不支援 RTSP 協定。這讓單純「想要在瀏覽器裡看到監控影像」變得麻煩許多。

為了解決這個問題，我研究了一下，最後決定用 Node.js 搭配 FFmpeg，把 RTSP 串流轉換成 MJPEG，再透過 HTTP 提供服務。這樣一來，瀏覽器只要打開頁面就能直接播放，不需要另外安裝播放器或插件。

這個小專案的定位很單純：快速、好用、方便展示，特別適合測試或 Demo 使用。

## 測試設定

為了方便測試和示範，建議可以使用手機作為 RTSP 串流來源：

### 手機測試方案

1. **下載測試應用程式**
   - 在 iOS 裝置上從 App Store 下載 [IP 攝像頭Lite](https://apps.apple.com/tw/app/ip%E6%94%9D%E5%83%8F%E9%A0%ADlite/id1013455241)

2. **設定 RTSP 串流**
   - 開啟應用程式並啟動攝像頭功能
   - 應用程式會將手機攝像頭的即時影像轉換為 RTSP 串流
   - 記下產生的 RTSP URL（範例：`rtsp://192.168.0.147:8554/live`）

3. **連接至本專案**
   - 將產生的 RTSP URL 輸入到網頁介面中
   - 點擊「開始串流」即可在瀏覽器中觀看轉換後的 MJPEG 串流

## 功能特色

- 輕鬆將 RTSP 串流轉換為 MJPEG 格式
- 透過網頁方便查看串流
- 支援自訂 RTSP URL，

## 系統需求

- Node.js（建議使用 12.x 或更新版本）
- npm（安裝 Node.js 時會自動安裝）

## 安裝步驟

1. 複製此儲存庫或下載原始碼
2. 進入專案目錄
3. 執行以下指令安裝所需套件：

```bash
npm install
```

## 使用方式

1. 啟動伺服器：

```bash
npm start
```

2. 用瀏覽器開啟 `http://localhost:3000`

3. 在輸入欄位中輸入您的 RTSP URL（如果沒有輸入，將使用預設值）

4. 點擊「開始串流」即可查看視訊內容

## 環境變數設定

您可以透過以下環境變數來自訂應用程式的行為：

- `PORT`：設定伺服器監聽的連接埠（預設值：3000）
- `RTSP_URL`：設定預設的 RTSP URL

使用範例：

```bash
PORT=8080 RTSP_URL=rtsp://your-camera.example.com/stream npm start
```

## 運作原理

1. 使用 `fluent-ffmpeg` 和 `ffmpeg-static` 來處理 RTSP 串流
2. 系統會將 RTSP 串流解碼並轉換為 MJPEG 格式
3. 轉換後的 MJPEG 串流會透過 Express.js HTTP 端點提供服務
4. 網頁介面使用 HTML `<img>` 標籤來顯示串流內容

## 故障排除

如果遇到問題，請參考以下建議：

- 如果看不到視訊串流，請確認 RTSP URL 是否正確，以及伺服器是否能夠正常存取
- 檢查您的防火牆設定，確保允許連接到 RTSP 來源
- 查看主控台輸出，檢查是否有 FFmpeg 相關的錯誤訊息
